on:
  workflow_dispatch:
    inputs:
      seuil:
        description: 'Seuil pour la classification (entre 0 et 1)'
        required: true

jobs:
  load_model_and_predict:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout du code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas scikit-learn

    - name: Exécute le script Python avec le seuil
      run: |
        python script.py
      env:
        PYTHONPATH: ${{ github.workspace }}
        SEUIL: ${{ github.event.inputs.seuil }}

  check_threshold_and_deploy:
    runs-on: ubuntu-latest
    needs: load_model_and_predict

    steps:
    - name: Checkout du code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas scikit-learn

    - name: Exécute le script Python avec mise en avant du seuil
      run: |
        python threshold_check.py
      env:
        PYTHONPATH: ${{ github.workspace }}
        SEUIL: ${{ secrets.SEUIL }}
